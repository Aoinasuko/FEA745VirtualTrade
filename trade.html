<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>ãƒ•ã‚£ãƒ¼(FEA)äº¤æ˜“æ‰€ - FEA745 Virtual Trade</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ethers/6.10.0/ethers.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/luxon@3.4.4/build/global/luxon.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-luxon@1.3.1/dist/chartjs-adapter-luxon.min.js"></script>

    <style>
        :root { --primary: #007bff; --bg: #f4f7f6; --card-bg: #ffffff; --text: #333; }
        body { font-family: "Segoe UI", sans-serif; margin: 0; background: var(--bg); color: var(--text); height: 100vh; display: flex; flex-direction: column; }
        
        nav { background: white; padding: 15px 20px; box-shadow: 0 2px 5px rgba(0,0,0,0.05); display: flex; justify-content: space-between; align-items: center; flex-shrink: 0; }
        nav a { text-decoration: none; color: #555; margin-left: 20px; font-weight: bold; }
        .logo { font-size: 1.2em; font-weight: bold; color: var(--primary); }

        .main-container { display: flex; flex: 1; overflow: hidden; }
        
        /* ã‚µã‚¤ãƒ‰ãƒãƒ¼ */
        .sidebar { width: 300px; background: white; border-right: 1px solid #ddd; overflow-y: auto; padding: 10px; display: flex; flex-direction: column; }
        .token-item { padding: 15px; border-bottom: 1px solid #eee; cursor: pointer; transition: 0.2s; border-radius: 8px; margin-bottom: 5px; }
        .token-item:hover { background: #f0f8ff; }
        .token-item.active { background: #e7f1ff; border-left: 4px solid var(--primary); }
        .token-symbol { font-weight: bold; font-size: 1.1em; }
        .token-name { font-size: 0.8em; color: #666; }
        .token-price { float: right; font-weight: bold; color: var(--primary); }

        /* ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ */
        .content { flex: 1; padding: 20px; overflow-y: auto; display: flex; flex-direction: column; gap: 20px; }
        
        /* ãƒãƒ£ãƒ¼ãƒˆ */
        .chart-card { background: var(--card-bg); padding: 20px; border-radius: 12px; box-shadow: 0 4px 10px rgba(0,0,0,0.05); height: 400px; position: relative; }
        #loadingChart { position: absolute; top:50%; left:50%; transform:translate(-50%, -50%); background:rgba(255,255,255,0.9); padding:10px 20px; border-radius:5px; font-weight:bold; color:#666; }

        /* å–å¼•ãƒ‘ãƒãƒ« */
        .trade-card { background: var(--card-bg); padding: 25px; border-radius: 12px; box-shadow: 0 4px 10px rgba(0,0,0,0.05); max-width: 600px; margin: 0 auto; width: 100%; box-sizing: border-box; }
        
        .tabs { display: flex; margin-bottom: 20px; border-bottom: 2px solid #eee; }
        .tab { flex: 1; text-align: center; padding: 10px; cursor: pointer; font-weight: bold; color: #999; }
        .tab.active { color: var(--primary); border-bottom: 2px solid var(--primary); }
        .tab.sell-tab.active { color: #dc3545; border-bottom-color: #dc3545; }

        input { width: 100%; padding: 15px; margin: 10px 0; border: 1px solid #ddd; border-radius: 8px; box-sizing: border-box; font-size: 1.1em; }
        
        .action-btn { width: 100%; padding: 15px; border: none; border-radius: 8px; font-size: 1.1em; font-weight: bold; cursor: pointer; color: white; margin-top: 10px; }
        .btn-buy { background: var(--primary); }
        .btn-buy:hover { background: #0056b3; }
        .btn-sell { background: #dc3545; }
        .btn-sell:hover { background: #c82333; }

        .info-row { display: flex; justify-content: space-between; font-size: 0.9em; color: #666; margin-bottom: 5px; }
        
        /* MetaMaskè¿½åŠ ãƒœã‚¿ãƒ³ */
        .add-mm-btn { background: #e2e6ea; border: none; color: #333; cursor: pointer; padding: 5px 10px; border-radius: 20px; font-size: 0.8em; display: inline-flex; align-items: center; gap: 5px; margin-left: 10px; transition: 0.2s; }
        .add-mm-btn:hover { background: #dbe2e8; }
        
        /* ãƒãƒ¼ãƒŠãƒ¼ã‚¦ã‚©ãƒ¬ãƒƒãƒˆåˆ¶å¾¡ */
        .burner-control { font-size:0.9em; background:#fff3cd; padding:10px; border-radius:5px; margin-bottom:10px; text-align:center;}
    </style>
</head>
<body>

    <nav>
        <div class="logo">Fea Exchange ğŸ“Š</div>
        <div>
            <a href="index.html">ğŸ  ãƒ›ãƒ¼ãƒ </a>
            <a href="trade.html">ğŸ“ˆ å–å¼•æ‰€</a>
        </div>
        <button id="connectBtn" style="margin-left:20px; padding:8px 15px; cursor:pointer;">æ¥ç¶š</button>
    </nav>

    <div class="main-container">
        <div class="sidebar" id="tokenList">
            <div style="padding:10px; text-align:center; color:#999;">èª­è¾¼ä¸­...</div>
        </div>

        <div class="content" id="mainContent" style="visibility: hidden;">
            
            <div class="chart-card">
                <div style="display:flex; align-items:center; margin-bottom:10px;">
                    <h2 id="chartTitle" style="margin:0;">Chart</h2>
                    <button class="add-mm-btn" onclick="addCurrentTokenToWallet()">
                        ğŸ¦Š ã‚¦ã‚©ãƒ¬ãƒƒãƒˆã«è¿½åŠ 
                    </button>
                </div>
                <div id="loadingChart">å±¥æ­´ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ä¸­...</div>
                <canvas id="priceChart"></canvas>
            </div>

            <div class="trade-card">
                <div class="burner-control">
                    <strong>âš¡ é«˜é€Ÿå–å¼•ãƒ¢ãƒ¼ãƒ‰ (Burner)</strong><br>
                    <span id="burnerStatus">æœªè¨­å®š</span>
                    <div id="burnerButtons" style="margin-top:5px;">
                        <button onclick="setupBurnerWallet()">åˆ©ç”¨é–‹å§‹</button>
                    </div>
                    <div id="burnerPanel" style="display:none; margin-top:5px; border-top:1px dashed #ccc; padding-top:5px;">
                        <small>æ®‹é«˜: <span id="burnerBalance">0</span> FEA</small><br>
                        <input type="number" id="depositAmount" placeholder="Amount" style="width:80px; padding:5px; font-size:0.8em;">
                        <button onclick="depositToBurner()" style="font-size:0.8em;">å…¥é‡‘</button>
                        <button onclick="withdrawFromBurner()" style="font-size:0.8em;">å…¨é¡å‡ºé‡‘</button>
                    </div>
                </div>

                <div class="tabs">
                    <div class="tab active" onclick="setMode('buy')" id="tabBuy">è²·ã† (Buy)</div>
                    <div class="tab" onclick="setMode('sell')" id="tabSell">å£²ã‚‹ (Sell)</div>
                </div>

                <div class="info-row">
                    <span>ã‚ãªãŸã®æ®‹é«˜:</span>
                    <span id="userBalance">0</span>
                </div>

                <label>æ•°é‡å…¥åŠ›:</label>
                <input type="number" id="inputAmount" placeholder="0.0">
                
                <div class="info-row" style="margin-top:5px;">
                    <span>äºˆæƒ³ãƒ¬ãƒ¼ãƒˆ:</span>
                    <span id="ratePreview">1 Token = ? FEA</span>
                </div>

                <button id="actionBtn" class="action-btn btn-buy" onclick="executeSwap()">FEAã§è²·ã†</button>
            </div>
        </div>
    </div>

    <script>
        // â–¼â–¼â–¼ è¨­å®šã‚¨ãƒªã‚¢ (ç’°å¢ƒã«åˆã‚ã›ã¦æ›´æ–°ã—ã¦ãã ã•ã„) â–¼â–¼â–¼
        const RPC_URL = "https://fea745virtualtrade.com"; 
        const CHAIN_ID = 745n;
        const FEA_ADDRESS = "0x6b94D5B9E88Ff2D6fFA88297892a54427a8d0623";
        const DEX_ADDRESS = "0x0a103cd4a36902Ae6ca0af8503D1d887432B02dA";
        // â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²

        const DEX_ABI = [
            "function allTokens(uint256) view returns (address)",
            "function pools(address) view returns (uint256, uint256, bool)",
            "function swap(address token, bool isBuying, uint256 amountIn) external",
            // ã‚¤ãƒ™ãƒ³ãƒˆå®šç¾© (é‡è¦: ã“ã“ãŒé•ã†ã¨å±¥æ­´ãŒå–ã‚Œã¾ã›ã‚“)
            "event Swapped(address indexed token, address indexed user, string action, uint256 amountIn, uint256 amountOut)"
        ];
        const ERC20_ABI = [
            "function name() view returns (string)",
            "function symbol() view returns (string)",
            "function decimals() view returns (uint8)",
            "function balanceOf(address) view returns (uint256)",
            "function approve(address, uint256) returns (bool)",
            "function allowance(address, address) view returns (uint256)",
            "function transfer(address, uint256) returns (bool)"
        ];

        let provider, signer, dexContract, feaContract;
        let currentToken = null;
        let isBuying = true;
        let chartInstance = null;
        let priceInterval = null;
        
        // Burner Walletç”¨
        let burnerWallet = null;
        let useBurner = false;

        async function init() {
            if (window.ethereum) {
                provider = new ethers.BrowserProvider(window.ethereum);
                document.getElementById("connectBtn").onclick = connect;
                try {
                    const accounts = await provider.listAccounts();
                    if(accounts.length > 0) connect();
                } catch(e){}
            } else {
                alert("MetaMaskãŒå¿…è¦ã§ã™");
            }
        }

        async function connect() {
            try {
                signer = await provider.getSigner();
                const network = await provider.getNetwork();
                if(network.chainId != CHAIN_ID) return alert("Fea Chain (745) ã«åˆ‡ã‚Šæ›¿ãˆã¦ãã ã•ã„ã€‚");
                
                dexContract = new ethers.Contract(DEX_ADDRESS, DEX_ABI, signer);
                feaContract = new ethers.Contract(FEA_ADDRESS, ERC20_ABI, signer);
                
                document.getElementById("connectBtn").innerText = "æ¥ç¶šæ¸ˆã¿";
                loadTokenList();
            } catch(e) { console.error(e); alert("æ¥ç¶šã‚¨ãƒ©ãƒ¼"); }
        }

        // --- 1. ãƒˆãƒ¼ã‚¯ãƒ³ä¸€è¦§èª­è¾¼ ---
        async function loadTokenList() {
            const listEl = document.getElementById("tokenList");
            listEl.innerHTML = "";
            let index = 0;
            while(true) {
                try {
                    // ã‚¨ãƒ©ãƒ¼ãŒå‡ºã‚‹ã¾ã§å…¨ãƒˆãƒ¼ã‚¯ãƒ³ã‚’å–å¾—
                    const tokenAddr = await dexContract.allTokens(index);
                    const tokenContract = new ethers.Contract(tokenAddr, ERC20_ABI, provider);
                    const [name, symbol, poolData] = await Promise.all([
                        tokenContract.name(), tokenContract.symbol(), dexContract.pools(tokenAddr)
                    ]);
                    
                    const feaRes = parseFloat(ethers.formatEther(poolData[0]));
                    const tokenRes = parseFloat(ethers.formatEther(poolData[1]));
                    const price = tokenRes > 0 ? (feaRes / tokenRes) : 0;

                    const item = document.createElement("div");
                    item.className = "token-item";
                    item.innerHTML = `<div class="token-symbol">${symbol} <span class="token-price">${price.toFixed(4)} FEA</span></div><div class="token-name">${name}</div>`;
                    item.onclick = () => selectToken(tokenAddr, symbol, name, item);
                    listEl.appendChild(item);
                    index++;
                } catch (e) { 
                    if(index === 0) listEl.innerHTML = "<div style='padding:10px'>ã¾ã ãƒˆãƒ¼ã‚¯ãƒ³ãŒã‚ã‚Šã¾ã›ã‚“</div>";
                    break; 
                }
            }
        }

        // --- 2. ãƒˆãƒ¼ã‚¯ãƒ³é¸æŠ ---
        async function selectToken(address, symbol, name, domElement) {
            document.querySelectorAll(".token-item").forEach(el => el.classList.remove("active"));
            domElement.classList.add("active");
            document.getElementById("mainContent").style.visibility = "visible";
            document.getElementById("chartTitle").innerText = `${symbol} / FEA`;

            currentToken = { address, symbol, name };
            updateUserBalance();
            
            // ãƒãƒ£ãƒ¼ãƒˆèª­ã¿è¾¼ã¿é–‹å§‹
            loadChartHistory();
        }

        // --- â˜… æ©Ÿèƒ½è¿½åŠ : MetaMaskã«ãƒˆãƒ¼ã‚¯ãƒ³ã‚’è¿½åŠ  ---
        async function addCurrentTokenToWallet() {
            if(!currentToken) return;
            try {
                // ERC20ã‚³ãƒ³ãƒˆãƒ©ã‚¯ãƒˆã‹ã‚‰decimalsã‚’å–å¾—ï¼ˆé€šå¸¸18ã ãŒå¿µã®ãŸã‚ï¼‰
                const tokenContract = new ethers.Contract(currentToken.address, ERC20_ABI, provider);
                const decimals = await tokenContract.decimals();

                await window.ethereum.request({
                    method: 'wallet_watchAsset',
                    params: {
                        type: 'ERC20',
                        options: {
                            address: currentToken.address,
                            symbol: currentToken.symbol,
                            decimals: Number(decimals),
                        },
                    },
                });
            } catch (error) {
                console.error(error);
                alert("MetaMaskã¸ã®è¿½åŠ ã«å¤±æ•—ã—ã¾ã—ãŸ: " + error.message);
            }
        }

        // --- â˜… ä¿®æ­£: ãƒãƒ£ãƒ¼ãƒˆå±¥æ­´èª­è¾¼ ---
        async function loadChartHistory() {
            // ã‚¿ã‚¤ãƒãƒ¼è§£é™¤
            if(priceInterval) clearInterval(priceInterval);
            
            const ctx = document.getElementById('priceChart').getContext('2d');
            if(chartInstance) chartInstance.destroy();

            // ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¡¨ç¤º
            const loader = document.getElementById("loadingChart");
            loader.style.display = "block";
            loader.innerText = "å±¥æ­´ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ä¸­...";

            // ç©ºãƒãƒ£ãƒ¼ãƒˆã®ä½œæˆ
            chartInstance = new Chart(ctx, {
                type: 'line',
                data: {
                    datasets: [{
                        label: 'Price (FEA)',
                        data: [],
                        borderColor: '#007bff',
                        backgroundColor: 'rgba(0, 123, 255, 0.1)',
                        tension: 0.1,
                        fill: true,
                        pointRadius: 3
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: { x: { type: 'time', time: { unit: 'minute' } } }
                }
            });

            try {
                const currentBlock = await provider.getBlockNumber();
                // éå»24æ™‚é–“åˆ†ï¼ˆãƒªã‚»ãƒƒãƒˆç›´å¾Œã¯ãƒã‚¤ãƒŠã‚¹ã«ãªã‚‹ã®ã‚’é˜²ãï¼‰
                const blocksPerDay = (24 * 60 * 60) / 5; 
                const startBlock = Math.max(0, currentBlock - blocksPerDay);

                // ã‚¤ãƒ™ãƒ³ãƒˆå–å¾—
                const filter = dexContract.filters.Swapped(currentToken.address);
                const events = await dexContract.queryFilter(filter, startBlock, currentBlock);

                // â˜…ä¿®æ­£ç‚¹: ã‚¤ãƒ™ãƒ³ãƒˆãŒ0ä»¶ã®å ´åˆã¯å³çµ‚äº†ã—ã¦ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚’æ¶ˆã™
                if (events.length === 0) {
                    console.log("No trade history found.");
                    loader.style.display = "none";
                    startRealtimeUpdate();
                    return;
                }

                // ãƒ‡ãƒ¼ã‚¿å‡¦ç†
                const chartData = [];
                for (const event of events) {
                    // ãƒ–ãƒ­ãƒƒã‚¯æ™‚åˆ»å–å¾—ï¼ˆã“ã“ãŒå°‘ã—é‡ã„ã‹ã‚‚ï¼‰
                    const block = await event.getBlock(); 
                    const args = event.args; 
                    
                    const amountIn = parseFloat(ethers.formatEther(args[3]));
                    const amountOut = parseFloat(ethers.formatEther(args[4]));
                    const action = args[2];

                    let price = 0;
                    if (action === "Buy" && amountOut > 0) price = amountIn / amountOut;
                    else if (action === "Sell" && amountIn > 0) price = amountOut / amountIn;

                    if(price > 0) {
                        chartData.push({ x: block.timestamp * 1000, y: price });
                    }
                }

                chartInstance.data.datasets[0].data = chartData;
                chartInstance.update();

            } catch(e) {
                console.error("Chart Error:", e);
                loader.innerText = "ãƒ‡ãƒ¼ã‚¿å–å¾—ã‚¨ãƒ©ãƒ¼ (Consoleå‚ç…§)";
                // ã‚¨ãƒ©ãƒ¼ã§ã‚‚æ­¢ã¾ã‚‰ãªã„ã‚ˆã†ã«ã™ã‚‹
                setTimeout(() => { loader.style.display = "none"; }, 2000);
            } finally {
                // æˆåŠŸã—ã¦ã‚‚å¤±æ•—ã—ã¦ã‚‚ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã¯æ¶ˆã™
                loader.style.display = "none";
                startRealtimeUpdate();
            }
        }

        // ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ›´æ–°ï¼ˆ5ç§’æ¯ï¼‰
        function startRealtimeUpdate() {
            priceInterval = setInterval(async () => {
                try {
                    const pool = await dexContract.pools(currentToken.address);
                    const feaRes = parseFloat(ethers.formatEther(pool[0]));
                    const tokenRes = parseFloat(ethers.formatEther(pool[1]));
                    const price = tokenRes > 0 ? (feaRes / tokenRes) : 0;
                    
                    // ç¾åœ¨æ™‚åˆ»ã§ãƒ—ãƒ­ãƒƒãƒˆ
                    chartInstance.data.datasets[0].data.push({ x: Date.now(), y: price });
                    
                    // ãƒ‡ãƒ¼ã‚¿ãŒå¢—ãˆã™ããŸã‚‰å¤ã„ã‚‚ã®ã‚’æ¶ˆã™
                    if(chartInstance.data.datasets[0].data.length > 100) {
                        chartInstance.data.datasets[0].data.shift();
                    }
                    chartInstance.update();
                    
                    document.getElementById("ratePreview").innerText = `Rate: 1 ${currentToken.symbol} â‰’ ${price.toFixed(4)} FEA`;
                } catch(e){}
            }, 5000);
        }

        // --- å–å¼•ãƒ»Burneré–¢é€£ ---
        function setMode(mode) {
            isBuying = (mode === 'buy');
            document.getElementById("tabBuy").className = isBuying ? "tab active" : "tab";
            document.getElementById("tabSell").className = isBuying ? "tab" : "tab sell-tab active";
            const btn = document.getElementById("actionBtn");
            btn.className = isBuying ? "action-btn btn-buy" : "action-btn btn-sell";
            btn.innerText = isBuying ? "FEAã§è²·ã†" : "å£²ã‚‹";
            updateUserBalance();
        }

        async function updateUserBalance() {
            if(!currentToken) return;
            // ãƒ¡ã‚¤ãƒ³(Signer)ã®æ®‹é«˜
            if(signer) {
                let balance;
                if(isBuying) balance = await feaContract.balanceOf(await signer.getAddress());
                else {
                    const tContract = new ethers.Contract(currentToken.address, ERC20_ABI, signer);
                    balance = await tContract.balanceOf(await signer.getAddress());
                }
                document.getElementById("userBalance").innerText = parseFloat(ethers.formatEther(balance)).toFixed(2);
            }
            // Burnerã®æ®‹é«˜
            updateBurnerBalance();
        }

        // Burner Wallet
        function setupBurnerWallet() {
            let pk = localStorage.getItem("burner_pk");
            if (!pk) {
                pk = ethers.Wallet.createRandom().privateKey;
                localStorage.setItem("burner_pk", pk);
            }
            const jsonProvider = new ethers.JsonRpcProvider(RPC_URL);
            burnerWallet = new ethers.Wallet(pk, jsonProvider);
            useBurner = true;
            document.getElementById("burnerStatus").innerHTML = `<span style="color:green">ON</span> (${burnerWallet.address.substring(0,6)}...)`;
            document.getElementById("burnerPanel").style.display = "block";
            updateBurnerBalance();
        }

        async function updateBurnerBalance() {
            if(!burnerWallet) return;
            const c = new ethers.Contract(FEA_ADDRESS, ERC20_ABI, provider);
            const bal = await c.balanceOf(burnerWallet.address);
            document.getElementById("burnerBalance").innerText = parseFloat(ethers.formatEther(bal)).toFixed(2);
        }

        async function depositToBurner() {
            if(!signer) return alert("MetaMaskæœªæ¥ç¶š");
            const val = document.getElementById("depositAmount").value;
            if(!val) return;
            try {
                const tx = await feaContract.transfer(burnerWallet.address, ethers.parseEther(val), { gasPrice: 0, gasLimit: 200000 });
                await tx.wait();
                alert("å…¥é‡‘å®Œäº†");
                updateUserBalance();
            } catch(e){ alert(e.message); }
        }

        async function withdrawFromBurner() {
            if(!burnerWallet) return;
            try {
                const c = new ethers.Contract(FEA_ADDRESS, ERC20_ABI, burnerWallet);
                const bal = await c.balanceOf(burnerWallet.address);
                const tx = await c.transfer(await signer.getAddress(), bal, { gasPrice: 0, gasLimit: 200000 });
                await tx.wait();
                alert("å‡ºé‡‘å®Œäº†");
                updateUserBalance();
            } catch(e){ alert(e.message); }
        }

        async function executeSwap() {
            const val = document.getElementById("inputAmount").value;
            if(!val || val <= 0) return alert("æ•°é‡ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„");

            try {
                const amountWei = ethers.parseEther(val);
                let activeSigner = useBurner ? burnerWallet : signer;
                const userAddr = activeSigner.address;

                const activeFea = new ethers.Contract(FEA_ADDRESS, ERC20_ABI, activeSigner);
                const activeDex = new ethers.Contract(DEX_ADDRESS, DEX_ABI, activeSigner);
                const activeToken = new ethers.Contract(currentToken.address, ERC20_ABI, activeSigner);

                // Approve
                if (isBuying) {
                    const allow = await activeFea.allowance(userAddr, DEX_ADDRESS);
                    if (allow < amountWei) {
                        if(!useBurner) alert("æ‰¿èªãŒå¿…è¦ã§ã™...");
                        const tx = await activeFea.approve(DEX_ADDRESS, amountWei, { gasPrice: 0, gasLimit: 500000 });
                        await tx.wait();
                    }
                } else {
                    const allow = await activeToken.allowance(userAddr, DEX_ADDRESS);
                    if (allow < amountWei) {
                        if(!useBurner) alert("æ‰¿èªãŒå¿…è¦ã§ã™...");
                        const tx = await activeToken.approve(DEX_ADDRESS, amountWei, { gasPrice: 0, gasLimit: 500000 });
                        await tx.wait();
                    }
                }

                if(!useBurner) alert("äº¤æ›å‡¦ç†ä¸­...");
                const tx = await activeDex.swap(currentToken.address, isBuying, amountWei, { gasPrice: 0, gasLimit: 1000000 });
                await tx.wait();
                
                if(!useBurner) alert("å®Œäº†ï¼");
                document.getElementById("inputAmount").value = "";
                updateUserBalance();

            } catch(e) {
                console.error(e);
                alert("ã‚¨ãƒ©ãƒ¼: " + (e.reason || e.message));
            }
        }

        init();
    </script>
</body>
</html>